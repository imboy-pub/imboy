% @doc IMBoy 调试配置文件
% 用于生产环境的调试和监控配置
% 使用方法: 在 sys.config 中引入此配置

[
    %% 调试工具配置
    {debug_tools, [
        %% 启用调试工具
        {enabled, true},
        
        %% Recon 配置
        {recon, [
            {enabled, true},
            {proc_count_limit, 20},
            {trace_limit, 1000},
            {memory_threshold, 100000000}, % 100MB
            {message_queue_threshold, 1000}
        ]},
        
        %% Observer CLI 配置
        {observer_cli, [
            {enabled, true},
            {refresh_interval, 2000}, % 2秒
            {max_rows, 50}
        ]},
        
        %% Redbug 配置
        {redbug, [
            {enabled, true},
            {time_limit, 60000}, % 60秒
            {msg_limit, 1000},
            {print_depth, 10}
        ]}
    ]},
    
    %% 日志增强配置
    {log_enhancement, [
        %% 结构化日志
        {structured_logging, true},
        
        %% 日志轮转配置
        {rotation, [
            {enabled, true},
            {max_size, 104857600}, % 100MB
            {max_files, 10},
            {compress, true}
        ]},
        
        %% 日志级别动态调整
        {dynamic_level, [
            {enabled, true},
            {default_level, info},
            {modules, [
                {websocket_handler, debug},
                {msg_c2c_logic, info},
                {user_logic, warning}
            ]}
        ]},
        
        %% 性能日志
        {performance_logging, [
            {enabled, true},
            {slow_query_threshold, 1000}, % 1秒
            {memory_usage_threshold, 50000000}, % 50MB
            {process_count_threshold, 10000}
        ]}
    ]},
    
    %% 监控配置
    {monitoring, [
        %% 系统监控
        {system_monitor, [
            {enabled, true},
            {check_interval, 30000}, % 30秒
            {cpu_threshold, 80.0},
            {memory_threshold, 85.0},
            {disk_threshold, 90.0}
        ]},
        
        %% 应用监控
        {app_monitor, [
            {enabled, true},
            {check_interval, 10000}, % 10秒
            {process_limit, 20000},
            {memory_limit, 1073741824}, % 1GB
            {message_queue_limit, 5000}
        ]},
        
        %% 集群监控
        {cluster_monitor, [
            {enabled, true},
            {check_interval, 15000}, % 15秒
            {node_timeout, 5000}, % 5秒
            {auto_reconnect, true}
        ]}
    ]},
    
    %% 性能分析配置
    {profiling, [
        %% 启用性能分析
        {enabled, false}, % 默认关闭，按需开启
        
        %% fprof 配置
        {fprof, [
            {enabled, false},
            {duration, 30000}, % 30秒
            {output_dir, "./log/profiling"}
        ]},
        
        %% eprof 配置
        {eprof, [
            {enabled, false},
            {functions, []}, % 指定要分析的函数
            {output_dir, "./log/profiling"}
        ]}
    ]},
    
    %% 崩溃分析配置
    {crash_analysis, [
        %% 自动分析崩溃转储
        {auto_analyze, true},
        
        %% 崩溃转储保留数量
        {keep_dumps, 5},
        
        %% 分析脚本路径
        {analyzer_script, "./script/erl_crashdump_analyzer.sh"},
        
        %% 通知配置
        {notification, [
            {enabled, false},
            {email, []},
            {webhook, []}
        ]}
    ]},
    
    %% 调试会话配置
    {debug_session, [
        %% 远程调试
        {remote_debug, [
            {enabled, true},
            {allowed_nodes, []}, % 空列表表示允许所有节点
            {session_timeout, 3600000} % 1小时
        ]},
        
        %% 调试命令历史
        {command_history, [
            {enabled, true},
            {max_entries, 1000},
            {persist, true},
            {history_file, "./log/debug_history.log"}
        ]}
    ]},
    
    %% 开发工具配置
    {dev_tools, [
        %% 代码热更新
        {hot_reload, [
            {enabled, false}, % 生产环境默认关闭
            {watch_dirs, ["./apps/*/src"]},
            {exclude_patterns, [".*\.beam$", ".*\.app$"]}
        ]},
        
        %% 测试工具
        {testing, [
            {enabled, false},
            {auto_test, false},
            {coverage, false}
        ]}
    ]}
].

# æ¶ˆæ¯ç»“æ„ä½“
```
Msg = {"id":ID, "status":Status, "type":Type, "from":From, "to":To, "payload": Payload, "server_ts": ServerTs}

Msg2 = {"type": "error", "code":Code, "payload": Payload, "server_ts": Ts}
```


## Msg2.error
* Msg2.code = 1 æ— éœ€å¼¹çª—é”™è¯¯ï¼Œå¯ä»¥è®°å½•æ—¥å¿—åç›´æ¥å¿½ç•¥é”™è¯¯ Msg2.payload å¯èƒ½ä¸ºç©ºï¼Œä¸éœ€è¦å¤„ç†
* Msg2.code = 2 å¸¦titleå¼¹çª—ï¼ŒMsg2.payload ä¸èƒ½ä¸ºç©º å¿…é¡»åŒ…å«title contentå­—æ®µ
* Msg2.code = 3 æ— titleå¼¹çª—ï¼ŒMsg2.payload ä¸èƒ½ä¸ºç©º å¿…é¡»åŒ…å« contentå­—æ®µ
* Msg2.code = 705 tokenæ— æ•ˆã€åˆ·æ–°token
* Msg2.code = 706 tokenæ— æ•ˆ (åŒ…å«ç¼ºå¤±tokenæƒ…å†µ) æˆ–è€…è®¾å¤‡IDä¸å­˜åœ¨ éœ€è¦é‡æ–°ç™»å½•

# Msg.id
Xid().toString()


# Msg.Type

## å•èŠï¼ˆc2c[any()]ï¼‰
* Msg.Type = <<"c2c">>

## ç¾¤èŠ(c2g[any()])

## æ¨é€(S2C)
* Payload.msg_type = logged_another_device åœ¨å…¶ä»–è®¾å¤‡ç™»å½•äº†, Payload.content = ""
* Payload.msg_type = online ç”¨æˆ·åœ¨çº¿çŠ¶æ€å˜æ›´, data['from'] ä¸ºå¥½å‹ID
* Payload.msg_type = offline ç”¨æˆ·åœ¨çº¿çŠ¶æ€å˜æ›´, data['from'] ä¸ºå¥½å‹ID
* Payload.msg_type = hide ç”¨æˆ·åœ¨çº¿çŠ¶æ€å˜æ›´, data['from'] ä¸ºå¥½å‹ID
* Payload.msg_type = apply_friend æ·»åŠ å¥½å‹ç”³è¯·, Payload.content = ""
* Payload.msg_type = apply_friend_confirm æ·»åŠ å¥½å‹ç”³è¯·ç¡®è®¤, Payload.content = ""

apply_friend
```
{"from":{"source":"qrcode","msg":"æˆ‘æ˜¯ nick leeyiğŸ‘ğŸ»ğŸ‘ğŸ»å°±","remark":"leeyi101","role":"all","donotlookhim":false,"donotlethimlook":true},"to":{},"msg_type":"custom","custom_type":"apply_friend"}
```

## å®¢æˆ·ç«¯ç¡®è®¤æ¶ˆæ¯ CLIENT_ACK
```
% å®¢æˆ·ç«¯ç¡®è®¤æ¶ˆæ¯
websocket_handle({text, <<"CLIENT_ACK", Tail/binary>>}, State) ->
    [Type, MsgId, DID] = binary:split(Tail, <<",">>, [global]),
    ?LOG(["CLIENT_ACK", Tail]),
    CurrentUid = proplists:get_value(current_uid, State),
    case Type of
        <<"C2C">> ->
            websocket_logic:c2c_client_ack(MsgId, CurrentUid, DID),
            {ok, State, hibernate};
        <<"S2C">> ->
            websocket_logic:s2c_client_ack(MsgId, CurrentUid, DID),
            {ok, State, hibernate}
    end;
```

# ServerTs
æœåŠ¡å™¨çš„å½“å‰æ¯«ç§’æ—¶é—´æˆ³
```
 Ts = util_dt:milliseconds(),
```
